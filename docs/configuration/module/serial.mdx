---
id: serial
title: Настройки модуля Serial
sidebar_label: Serial
description: Модуль даёт интерфейс для общения и управления устройством Meshtastic через Serial‑порт.
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import { Icon } from "@iconify/react";
import ReactPlayer from "react-player";

Опции конфигурации модуля Serial: Enabled, Echo, Mode, Receive GPIO, Transmit GPIO, Baud Rate, Timeout и Override Console Serial Port. Конфиг модуля Serial отправляется админ-сообщением `ConfigModule.Serial` (protobuf).

Это интерфейс для общения и управления устройством Meshtastic через Serial‑порт. Модуль можно перевести в разные [режимы](#mode), каждый под свою задачу.

![image](/img/modules/Serial/jet.webp)

<div style={{ maxWidth: "800px", margin: "auto" }}>
  <ReactPlayer
    url="https://youtu.be/HdOiGKBtapw"
    controls
    width="100%"
    height="400px"
  />
</div>

## Значения конфигурации модуля Serial {#serial-module-config-values}

### Включено {#enabled}

Включает модуль Serial.

### Echo {#echo}

Если включено, любые отправленные вами пакеты будут приходить обратно на устройство.

### Режим {#mode}

По умолчанию — 'Simple'.

Доступные значения:

- `DEFAULT` равен `SIMPLE`.
- `SIMPLE` работает как простой туннель UART. Что вошло — то вышло, требует Channel с именем 'serial'.
- `PROTO` открывает Protobuf Client API на этом порту. Можно подключаться с другого устройства, см. [Arduino client library](https://github.com/meshtastic/Meshtastic-arduino) и [API Reference](/docs/development/device/client-api).
- `TEXTMSG` позволяет отправить строку в Serial‑порт на устройство — она будет отправлена как текстовое сообщение в Channel по умолчанию. Любое текстовое сообщение из Mesh будет послано в Serial в виде: `<Short Name>: <text>`.
- `NMEA` выводит поток NMEA 0183 с внутренним GPS/фиксированной позицией и местоположениями других узлов как Waypoints (WPL).
- `CALTOPO` выводит NMEA 0183 Waypoints (WPL) каждые 10 секунд для всех валидных местоположений узлов для [CalTopo / SARTopo](/docs/software/integrations/caltopo.mdx).
- `WS85` парсит и вычисляет скорость ветра, получаемую по Serial от Ecowitt WS85. Отправляет значения через telemetry‑пакет каждые 5 минут. Требуется модификация датчика WS85 (https://hackaday.io/project/196990-meshtastic-ultrasonic-anemometer-wx-station). Если опции нет в приложении — включите через CLI командой "meshtastic --set serial.mode 6"

:::tip совет
Режим `PROTO` не даёт очевидного вывода при пассивном просмотре через Serial‑монитор. Для теста используйте [Python CLI](https://github.com/meshtastic/python) с опцией `--listen`, чтобы видеть поток protobuf‑ов.
:::

### Пин Receive GPIO {#receive-gpio-pin}

Укажите GPIO‑пин, подключённый к RXD.

:::tip совет
Для RAK4631 на RAK19007 и некоторых версиях базовой платы RAK19003 пины по умолчанию — TXD1 (16) и RXD1 (15). Для этого устройства нужно выставить [GPS Mode](/docs/configuration/radio/position/#gps-mode) в `Not_Present`. Для других версий RAK19003 доступны пины TXD0 (20) и RXD0 (19).
:::

### Пин Transmit GPIO {#transmit-gpio-pin}

Укажите GPIO‑пин, подключённый к TXD.

:::tip совет
Подключайте TX одного устройства к RX другого и наоборот. Соедините их GND (не нужно, если оба питаются от одного USB‑источника).
:::

### Baud Rate {#baud-rate}

Скорость Serial.

### Timeout {#timeout}

Время ожидания, после которого пакет считается «готов».

### Override Console Serial Port {#override-console-serial-port}

Если true, позволит модулю Serial управлять (задавать baud rate) и использовать основной USB‑Serial для вывода. Полезно только для режимов NMEA и CalTopo, в других режимах может работать странно или не работать вовсе. Если заданы TX/RX пины в настройках модуля Serial — этот параметр игнорируется.

:::tip совет
После изменения настроек модуля нужна **перезагрузка**, чтобы они вступили в силу.
:::

## Доступность настроек модуля Serial в клиентах {#serial-module-config-client-availability}

<Tabs
  groupId="settings"
  defaultValue="apple"
  values={[
    {
      label: (
        <>
          <Icon icon="mdi:android" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Android
        </>
      ),
      value: "android",
    },
    {
      label: (
        <>
          <Icon icon="mdi:apple" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Apple
        </>
      ),
      value: "apple",
    },
    {
      label: (
        <>
          <Icon icon="mdi:terminal" height="1.5rem" style={{ marginRight: "0.25rem" }} /> CLI
        </>
      ),
      value: "cli",
    },
    {
      label: (
        <>
          <Icon icon="mdi:internet" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Web
        </>
      ),
      value: "web",
    },
  ]}>
<TabItem value="android">

#### Android

:::info информация

Опции конфигурации модуля Serial доступны на Android.

1. Откройте приложение Meshtastic
2. Перейдите: **Вертикальное многоточие (3 точки справа сверху) > Radio Configuration > Serial**

:::

</TabItem>
<TabItem value="apple">

#### Apple

:::info информация
Все настройки модуля Serial доступны на iOS, iPadOS и macOS: Settings > Module Configuration > Serial.
:::

</TabItem>
<TabItem value="cli">

#### CLI

:::info информация

Все опции конфигурации доступны в python CLI. Примеры команд ниже:

:::

|               Setting               |                                                                                              Acceptable Values                                                                                               |               Default                |
| :---------------------------------: | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | :----------------------------------: |
|           serial.enabled            |                                                                                               `true`, `false`                                                                                                |               `false`                |
|             serial.echo             |                                                                                               `true`, `false`                                                                                                |               `false`                |
|             serial.mode             |                                                                           `DEFAULT` `SIMPLE` `PROTO` `TEXTMSG`, `NMEA`, `CALTOPO`                                                                            |              `DEFAULT`               |
|             serial.rxd              |                                                                                             GPIO Pin Number 1-39                                                                                             |       Default of `0` is Unset        |
|             serial.txd              |                                                                                             GPIO Pin Number 1-33                                                                                             |       Default of `0` is Unset        |
|             serial.baud             | `BAUD_DEFAULT` `BAUD_110` `BAUD_300` `BAUD_600` `BAUD_1200` `BAUD_2400` `BAUD_4800` `BAUD_9600` `BAUD_19200` `BAUD_38400` `BAUD_57600` `BAUD_115200` `BAUD_230400` `BAUD_460800` `BAUD_576000` `BAUD_921600` |        `BAUD_DEFAULT` (38400)        |
|           serial.timeout            |                                                                                          `integer` (milli seconds)                                                                                           | Default of `0` corresponds to 250 ms |
| serial.override_console_serial_port |                                                                                               `true`, `false`                                                                                                |               `false`                |

:::tip совет

Так как устройство перезагружается после каждой команды из CLI, при настройке нескольких значений в одном разделе лучше объединять их в одну команду.

```shell title="Пример:"
meshtastic --set serial.enabled true --set serial.echo true
```

:::

```shell title="Включить / выключить модуль"
meshtastic --set serial.enabled true
meshtastic --set serial.enabled false
```

```shell title="Включить / выключить Echo"
meshtastic --set serial.echo true
meshtastic --set serial.echo false
```

```shell title="Выбрать режим"
meshtastic --set serial.mode DEFAULT
meshtastic --set serial.mode PROTO
```

```shell title="Назначить RXD на GPIO 7"
meshtastic --set serial.rxd 7
```

```shell title="Назначить TXD на GPIO 28"
meshtastic --set serial.txd 28
```

```shell title="Выбрать Baud Rate"
meshtastic --set serial.baud BAUD_DEFAULT
meshtastic --set serial.baud BAUD_576000
```

```shell title="Установить Timeout 15 мс"
meshtastic --set serial.timeout 15
```

</TabItem>
<TabItem value="web">

#### Web

:::info информация
Все опции конфигурации модуля Serial доступны в Web UI.
:::

</TabItem>
</Tabs>

:::warning предупреждение
Доступ к GPIO потенциально опасен: неверные настройки могут повредить или вывести из строя ваше железо. Перед экспериментами убедитесь, что вы понимаете схему именно вашего устройства. Гарантию мы не даём. Используйте на свой страх и риск.

Для работы этого модуля требуется подключаемая периферия. Без неё он не будет работать.
:::

## Примеры {#examples}

По умолчанию используются RX GPIO 16 и TX GPIO 17.

### Базовое использование {#basic-usage}

1. Включите модуль, установив `serial.enabled` в `1`.
2. Задайте пины (`serial.rxd` / `serial.txd`) для ваших RX и TX GPIO. Для плат tbeam рекомендуется:
   - RXD 13
   - TXD 14
3. Установите `serial.timeout` — время ожидания, после которого пакет считается завершённым.
4. (Опционально) установите serial.mode в `TEXTMSG`, если хотите отправлять/получать сообщения из общего текстового канала. Для более тонкого контроля используйте режим `PROTO`, например вместе с [Arduino client library](https://github.com/meshtastic/Meshtastic-arduino/blob/master/examples/SendReceiveClient/SendReceiveClient.ino).
5. Подключитесь к устройству по Serial с параметрами `38400 8N1`.

   С [tio](https://github.com/tio/tio) — `tio -e -b 38400 -f none /dev/myserialport`

6. Отправьте пакет длиной до 237 байт. Он будет транслирован по Channel по умолчанию.
7. (Опционально) установите `serial.echo` в `1` — и любое отправленное сообщение вернётся на устройство.

### Подключение PIR‑датчика к внешнему МК {#interfacing-pir-sensor-with-external-microcontroller}

Ниже примеры с Raspberry Pi Pico или Arduino Mini Pro, подключёнными к PIR‑датчику движения. При детекции движения сообщение отправляется по Serial на T‑Beam. T‑Beam транслирует его как текст по каналу по умолчанию, используя модуль Serial в режиме TXTMSG.

#### Конфигурация ПО Meshtastic {#meshtastic-software-configuration}

- Модуль Serial включён, режим: TEXTMSG
- GPIO‑пины (для T‑Beam) RX 13, TX 14
- 38400 Baud

#### Raspberry Pi Pico BOM {#raspberry-pi-pico-bom}

- Raspberry Pi Pico с [CircuitPython](https://learn.adafruit.com/getting-started-with-raspberry-pi-pico-circuitpython)
- T‑Beam V1.1 с Meshtastic
- PIR‑датчик ([модель Adafruit для макетки](https://www.adafruit.com/product/4871))

#### Схема подключения Raspberry Pi Pico {#raspberry-pi-pico-wiring}

![image](/img/modules/Serial/pico-pir-wiring.webp)

- TX пин 14 на T‑Beam к RX пину 2 на Pico
- RX пин 13 на T‑Beam к TX пину 1 на Pico
- Vcc и GND PIR на Vcc/GND шины макетной платы
- Линия триггера PIR к Pico GPIO28 (пин 34 Pico)
- GND пин T‑Beam к GND пину 38 на Pico
- GND пин 38 на Pico к земле макетной платы
- 3V3 пин 36 на Pico к плюсовой шине питания макетной платы
- Опционально, чтобы питать Pico от T‑Beam вместо USB:
  - Подключите 5V пин T‑Beam к Vbus пину 40 на Pico

#### Код на CircuitPython {#circuit-python-code}

```python
import time
import board
import busio
import digitalio

# Setup PIR sensor on GP28
pir = digitalio.DigitalInOut(board.GP28)
pir.direction = digitalio.Direction.INPUT

# Setup serial UART connection TX/RX on (GP0/GP1)
uart = busio.UART(board.GP0, board.GP1, baudrate=38400, timeout=0)

while True:
    if(pir.value == True):
        uart.write(bytes("Motion Detected", "ascii"))
        time.sleep(30)
    time.sleep(0.5)
```

#### Arduino Mini Pro BOM {#arduino-mini-pro-bom}

- Arduino Mini Pro с загруженным примером из раздела ниже
- T‑Beam V1.1 с Meshtastic
- PIR‑датчик ([модель Adafruit для макетки](https://www.adafruit.com/product/4871))

#### Схема подключения Arduino Mini Pro {#arduino-mini-pro-wiring}

![image](/img/modules/Serial/arduino-mini-pro-pir-wiring.webp)

- T‑BEAM RX PIN 13 к TX PIN на ARDUINO MINI
- T‑BEAM TX PIN 14 к RX PIN на ARDUINO MINI
- T‑BEAM PIN 3.3V к 3.3V PIN на ARDUINO MINI
- T‑BEAM PIN GND к GND PIN на ARDUINO MINI
- ARDUINO MINI PIN 2 к OUT PIN на PIR‑датчике
- ARDUINO MINI PIN 3.3V к 3.3V на PIR‑датчике
- ARDUINO MINI PIN GND к GND PIN на PIR‑датчике

#### Код для Arduino Mini Pro {#arduino-mini-pro-code}

```cpp
int LED = 13; // the pin to which the LED is connected
int PIR = 2;  // the pin to which the sensor is connected
int previousState = LOW; // previous state of the sensor


void setup() {
pinMode(LED, OUTPUT); // initialize the LED as an output
pinMode(PIR, INPUT);  // initialize the sensor as an input
Serial.begin(9600);   // initialize serial communication
}

void loop(){
   int currentState = digitalRead(PIR); // read the current state of the sensor
  if (currentState != previousState) { // check if the state has changed
    if (currentState == HIGH) { // check if there is motion
      digitalWrite(LED, HIGH);  // turn the LED on
      Serial.println("Motion Detected");
}
    else {
      digitalWrite(LED, LOW);  // turn the LED off
      Serial.println("No Motion");
    }
previousState = currentState; // update the previous state
  }
  delay(100); // small delay to avoid false sensor readings

}
```