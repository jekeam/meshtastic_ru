---
id: external-notification
title: Настройка модуля External Notification
sidebar_label: Внешние уведомления
description: Этот модуль позволяет подключить зуммер, динамик, LED или другой аксессуар к устройству Meshtastic.
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import { Icon } from "@iconify/react";
import ReactPlayer from "react-player";

Модуль External Notification позволяет подключить зуммер, динамик, LED или другое устройство, чтобы оповещать о новых сообщениях из Mesh. Можно включить до 3 пинов независимо друг от друга.

Опции конфигурации External Notification: Enabled, Active, Alert Bell (General), Alert Bell Vibra, Alert Bell Buzzer, Alert Message (General), Alert Message Vibra, Alert Message Buzzer, Output (General), Output Vibra, Output Buzzer, Output Milliseconds, Use PWM и Nag Timeout. Настройка External Notification отправляется админ‑сообщением с protobuf `ConfigModule.ExternalNotificationConfig`.

<div style={{ maxWidth: "800px", margin: "auto" }}>
  <ReactPlayer
    url="https://youtu.be/MWt3RHMpifo"
    controls
    width="100%"
    height="400px"
  />
</div>

## Параметры модуля внешних уведомлений {#external-notification-module-config-values}

### Включено {#enabled}

Включает модуль внешних уведомлений.

### Активность (общие / только LED) {#active-general-led-only}

Задает, активна ли внешняя цепь при низком или высоком уровне GPIO. Если true — пин активен при high, false — активен при low.

### Оповещение при bell (общие / LED, Vibra и Buzzer) {#alert-when-receiving-a-bell-general-led-vibra-and-buzzer}

Нужно ли срабатывать при получении входящего bell.

### Оповещение при сообщении (общие / LED, Vibra и Buzzer) {#alert-when-receiving-a-message-general-led-vibra-and-buzzer}

Нужно ли срабатывать при получении входящего сообщения.

### Пины GPIO (общие / LED, Vibra и Buzzer) {#gpio-pins-general-led-vibra-and-buzzer}

Указывает GPIO, к которому подключена ваша внешняя цепь. На устройствах с PWM‑зуммером можно использовать его для оповещений, установив свойство use_pwm в TRUE. Пин Buzzer будет игнорироваться, вместо него используется device.buzzer_gpio. Если включить режим PWM, устройство будет использовать рингтоны RTTTL для оповещений. Примеры RTTTL можно найти [здесь](https://www.laub-home.de/wiki/RTTTL_Songs) и загрузить в устройство через клиентское приложение.

:::info заметка
На платах на базе ESP32 GPIO 34–39 — это только входы (GPI). У них нет внутренних pull‑up/pull‑down резисторов и их нельзя использовать как выходы, то есть эти пины НЕ подойдут для выходов.
:::

### Длительность активации GPIO {#how-long-monitored-gpio-is-triggered}

Как долго, в миллисекундах, GPIO должен быть активен. Для режима повтора — это длительность каждого тона и паузы.

По умолчанию 0 = 1000 мс.

### Повтор (Nag Timeout) (общие / LED, Vibra и Buzzer) {#repeat-nag-timeout-general-led-vibra-and-buzzer}

Нужно ли повторять оповещение. Если значение больше нуля, оповещение будет повторяться, пока не нажата кнопка пользователя или не пройдет указанное число секунд.

## Где доступна настройка модуля External Notification {#external-notification-module-config-client-availability}

<Tabs
  groupId="settings"
  defaultValue="apple"
  values={[
    {
      label: (
        <>
          <Icon icon="mdi:android" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Android
        </>
      ),
      value: "android",
    },
    {
      label: (
        <>
          <Icon icon="mdi:apple" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Apple
        </>
      ),
      value: "apple",
    },
    {
      label: (
        <>
          <Icon icon="mdi:terminal" height="1.5rem" style={{ marginRight: "0.25rem" }} /> CLI
        </>
      ),
      value: "cli",
    },
    {
      label: (
        <>
          <Icon icon="mdi:internet" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Web
        </>
      ),
      value: "web",
    },
  ]}>
<TabItem value="android">

#### Android {#android}

:::info заметка

Опции External Notification доступны на Android.

1. Откройте приложение Meshtastic
2. Перейдите: **Vertical Ellipsis (3 точки, справа вверху) > Radio Configuration > External Notification**

:::

</TabItem>
<TabItem value="apple">

#### Apple {#apple}

:::info заметка
Все опции модуля внешних уведомлений доступны на iOS, iPadOS и macOS: Settings > Module Configuration > External Notification.
:::

</TabItem>
<TabItem value="cli">

#### CLI {#cli}

:::info заметка

Все опции модуля внешних уведомлений доступны в Python CLI. Примеры команд ниже:

:::

|               Параметр               |     Допустимые значения     | По умолчанию |
| :----------------------------------: | :--------------------------: | :----------: |
|     external_notification.enabled    |      `true`, `false`         |   `false`    |
|      external_notification.active    |      `true`, `false`         |   `false`    |
|    external_notification.alert_bell  |      `true`, `false`         |   `false`    |
| external_notification.alert_bell_vibra |    `true`, `false`         |   `false`    |
| external_notification.alert_bell_buzzer |   `true`, `false`        |   `false`    |
|  external_notification.alert_message |      `true`, `false`         |   `false`    |
| external_notification.alert_message_vibra | `true`, `false`         |   `false`    |
| external_notification.alert_message_buzzer | `true`, `false`        |   `false`    |
|      external_notification.output    |          `integer`           |     `0`      |
|   external_notification.output_vibra |          `integer`           |     `0`      |
|  external_notification.output_buzzer |          `integer`           |     `0`      |
|    external_notification.output_ms   | `integer` (миллисекунды)     |     `0`      |
|     external_notification.use_pwm    |      `true`, `false`         |   `false`    |
|   external_notification.nag_timeout  |  `integer` (секунды)         |     `0`      |

:::tip подсказка

Так как устройство перезагружается после каждой команды из CLI, при настройке нескольких значений лучше отправить их одной связкой.

```shell title="Пример:"
meshtastic --set external_notification.enabled true --set external_notification.alert_bell true
```

:::

```shell title="Включить/выключить модуль External Notification"
meshtastic --set external_notification.enabled true
meshtastic --set external_notification.enabled false
```

```shell title="Включить/выключить оповещение на bell"
meshtastic --set external_notification.alert_bell true
meshtastic --set external_notification.alert_bell false
```

```shell title="Установить активный уровень GPIO: high/low (по умолчанию false = low)"
meshtastic --set external_notification.active false
meshtastic --set external_notification.active true
```

```shell title="Включить/выключить оповещение на входящее сообщение"
meshtastic --set external_notification.alert_message true
meshtastic --set external_notification.alert_message false
```

```shell title="Задать GPIO для мониторинга: 21"
meshtastic --set external_notification.output 21
```

```shell title="Задать длительность сигнала на GPIO (0 = 1000 мс по умолчанию)"
meshtastic --set external_notification.output_ms 0
meshtastic --set external_notification.output_ms 1500
```

</TabItem>
<TabItem value="web">

#### Web {#web}

:::info заметка
Все настройки модуля External Notification доступны в Web UI.
:::

</TabItem>
</Tabs>

:::warning предупреждение
Доступ к GPIO потенциально опасен: неверные параметры могут повредить или вывести из строя ваше железо. Перед началом убедитесь, что вы понимаете схему именно вашего устройства — гарантию мы не предоставляем. Используйте на свой риск.

Для работы модуля нужно подключить внешнее устройство. Без него он не работает.
:::

## Примеры {#examples}

### Типы оповещений {#alert-types}

Поддерживаются два события:

1. Входящее текстовое сообщение

2. Входящее текстовое сообщение, содержащее символ ASCII bell. Сейчас отправить ASCII bell может только Python API, в будущем поддержка может расшириться.

:::info заметка
Символ bell — это ASCII 0x07. Вставьте 0x07 в любое место текстового сообщения и при включенном ext_notification.alert_bell будет выдано внешнее оповещение.
:::

## Внешняя периферия {#external-hardware}

Учитывайте максимальные токи sink/source для GPIO ESP32. Проще всего подключить LED или активный зуммер.

Идеи для внешней периферии:

- LED
- Активный зуммер
- Огнемёт
- Стробоскоп
- Сирена

## Известные ограничения {#known-limitations}

- Модуль отслеживает только текстовые сообщения. На другие типы пакетов не реагирует.