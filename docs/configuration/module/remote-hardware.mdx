---
id: remote-hardware
title: Использование модуля Удаленное оборудование
sidebar_label: Удаленное оборудование
description: Модуль Удаленное оборудование позволяет читать, писать и отслеживать GPIO на удалённом Node.
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import { Icon } from "@iconify/react";

Модуль Удаленное оборудование позволяет читать, писать и отслеживать GPIO на удалённом Node. Параметры: Enabled.

:::info заметка

Для версий Firmware > 2.5.3 этот модуль требует сборки собственного Firmware и удаления флага сборки `-DMESHTASTIC_EXCLUDE_REMOTEHARDWARE=1` в `platformio.ini`.
Кроме того, хотя настройка модуля может быть доступна в клиентах, установка и чтение GPIO сейчас возможны только через [Meshtastic Python CLI](/docs/software/python/cli)

:::

## Параметры Удаленное оборудование {#remote-hardware-config-values}

### Включено {#enabled}

Включен ли модуль.

## Доступность модуля Удаленное оборудование в клиентах {#remote-hardware-module-client-availability}

<Tabs
  groupId="settings"
  defaultValue="apple"
  values={[
    {
      label: (
        <>
          <Icon icon="mdi:android" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Android
        </>
      ),
      value: "android",
    },
    {
      label: (
        <>
          <Icon icon="mdi:apple" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Apple
        </>
      ),
      value: "apple",
    },
    {
      label: (
        <>
          <Icon icon="mdi:terminal" height="1.5rem" style={{ marginRight: "0.25rem" }} /> CLI
        </>
      ),
      value: "cli",
    },
    {
      label: (
        <>
          <Icon icon="mdi:internet" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Web
        </>
      ),
      value: "web",
    },
  ]}>

<TabItem value="android">

#### Android

:::info заметка
Все параметры модуля Удаленное оборудование доступны в приложении для Android.

1. Откройте приложение Meshtastic
2. Перейдите: **Вертикальное многоточие (3 точки вверху справа) > Конфигурация радио > Удаленное оборудование**
   :::

</TabItem>
<TabItem value="apple">

#### Apple

:::info заметка
Все параметры модуля Удаленное оборудование доступны в приложении для iOS, iPadOS и macOS: Настройки > Конфигурация модуля > Удаленное оборудование
:::

</TabItem>
<TabItem value="cli">

#### CLI

:::info заметка

Все параметры модуля Удаленное оборудование доступны в Python CLI.

:::

</TabItem>
<TabItem value="web">

#### Web

Не реализовано.

</TabItem>
</Tabs>

## Использование модуля Удаленное оборудование {#remote-hardware-module-usage}

:::warning осторожно
Доступ к GPIO потенциально опасен: неверные настройки могут физически повредить или вывести из строя устройство. Перед началом разберитесь в схеме именно вашего устройства. Гарантия не предоставляется. Используйте на свой риск.
:::

### Поддерживаемые операции {#supported-operations}

- Установить состояние любого GPIO
- Прочитать любой GPIO
- Получать уведомление по Mesh при изменении состояния любого GPIO.
  Учтите, быстрые изменения (например, короткие нажатия кнопки) не обнаруживаются. Для этого используйте модуль [датчик движения](/docs/configuration/module/detection-sensor).

Результаты чтения GPIO и уведомления об изменениях также отправляются в MQTT (если включено) в формате JSON (если включено).

### Настройка {#setup}

Установите свежий python-инструмент/библиотеку командой `pip3 install --upgrade meshtastic` на Windows/Linux/macOS. Подробности см. в [разделе про Python](/docs/software/python/cli/installation).

Чтобы запретить доступ посторонним, сначала создайте Channel `gpio`, который будет использоваться для аутентифицированного доступа к этой функции. Этот Channel нужно установить и на локальный, и на удалённый Node. Также включите модуль на обоих устройствах.

Процедура через python CLI:

1. Подключите локальное устройство по USB
2. Включите модуль Удаленное оборудование:
   ```shell
   meshtastic --set remote_hardware.enabled true
   ```
3. Создайте GPIO Channel:
   ```shell
   meshtastic --ch-add gpio
   ```
4. Проверьте, что Channel создан, и скопируйте длинный "Complete URL", который содержит все Channels устройства:
   ```shell
   meshtastic --info
   ```
5. Подключите удалённое устройство по USB (или используйте [Remote Admin](/docs/configuration/remote-admin), чтобы добраться до него через Mesh)
6. Включите модуль Удаленное оборудование:
   ```shell
   meshtastic --set remote_hardware.enabled true
   ```
7. Присоедините его к созданному gpio Channel:
   ```shell
   meshtastic --seturl theurlyoucopiedinstep3
   ```

Теперь оба устройства должны общаться через Channel `gpio`. Отправьте текстовое сообщение с одного на другое для проверки. Также выполните `--nodes`, чтобы убедиться, что второй Node появился.

### Маски {#masks}

Маска используется для выбора управляемых GPIO. Для GPIO 1 устанавливается бит 1 маски (0x2 в шестнадцатеричном виде), для GPIO 2 — бит 2 (0x4), и т.д.
Чтобы определить нужную маску для выбранных пинов, поможет программа на Python ниже (и её вывод):

```python
>>> for i in range(1,45):
...     print(f'GPIO:{i} mask:{hex(2**i)}')
...
GPIO:1 mask:0x2
GPIO:2 mask:0x4
GPIO:3 mask:0x8
GPIO:4 mask:0x10
GPIO:5 mask:0x20
GPIO:6 mask:0x40
GPIO:7 mask:0x80
GPIO:8 mask:0x100
GPIO:9 mask:0x200
GPIO:10 mask:0x400
GPIO:11 mask:0x800
GPIO:12 mask:0x1000
GPIO:13 mask:0x2000
GPIO:14 mask:0x4000
GPIO:15 mask:0x8000
GPIO:16 mask:0x10000
GPIO:17 mask:0x20000
GPIO:18 mask:0x40000
GPIO:19 mask:0x80000
GPIO:20 mask:0x100000
GPIO:21 mask:0x200000
GPIO:22 mask:0x400000
GPIO:23 mask:0x800000
GPIO:24 mask:0x1000000
GPIO:25 mask:0x2000000
GPIO:26 mask:0x4000000
GPIO:27 mask:0x8000000
GPIO:28 mask:0x10000000
GPIO:29 mask:0x20000000
GPIO:30 mask:0x40000000
GPIO:31 mask:0x80000000
GPIO:32 mask:0x100000000
GPIO:33 mask:0x200000000
GPIO:34 mask:0x400000000
GPIO:35 mask:0x800000000
GPIO:36 mask:0x1000000000
GPIO:37 mask:0x2000000000
GPIO:38 mask:0x4000000000
GPIO:39 mask:0x8000000000
GPIO:40 mask:0x10000000000
GPIO:41 mask:0x20000000000
GPIO:42 mask:0x40000000000
GPIO:43 mask:0x80000000000
GPIO:44 mask:0x100000000000
```

## Использование GPIO через Python CLI {#using-gpios-from-the-python-cli}

:::info заметка
Можно управлять или отслеживать GPIO для Node, подключённого по USB, установив `--dest` на ID локального Node. В этом случае Channel `gpio` не нужен.
:::

### Запись в GPIO {#writing-a-gpio}

```shell title="Пример: включение GPIO4"
meshtastic  --port /dev/ttyUSB0 --gpio-wrb 4 1 --dest 28979058
# Connected to radio
# Writing GPIO mask 0x10 with value 0x10 to !28979058
```

### Чтение GPIO {#reading-a-gpio}

```shell title="Пример: чтение GPIO4"
meshtastic --port /dev/ttyUSB0 --gpio-rd 0x10 --dest 28979058
# Connected to radio
# Reading GPIO mask 0x10 from !28979058
# GPIO read response gpio_value=16
```

:::note заметка
Если маска и gpio_value совпадают — значение "on". Если gpio_value равно 0 — значение "off".
:::

### Отслеживание изменений GPIO {#watching-for-gpio-changes}

```shell title="Пример: отслеживание изменений GPIO4"
meshtastic --port /dev/ttyUSB0 --gpio-watch 0x10 --dest 28979058
# Connected to radio
# Watching GPIO mask 0x10 from !28979058
# Received RemoteHardware typ=GPIOS_CHANGED, gpio_value=16
# Received RemoteHardware typ=GPIOS_CHANGED, gpio_value=0
# Received RemoteHardware typ=GPIOS_CHANGED, gpio_value=16
# < press ctrl-c to exit >
```

## Тестирование операций с GPIO {#testing-gpio-operations}

Вы можете выполнять эти операции из своего кода на Python, используя класс Meshtastic `RemoteHardwareClient`. Подробности — в документации [Python API](/docs/software/python/cli/installation).

Для проверки можно подключить простой светодиод и резистор, чтобы убедиться, что операции с GPIO работают. В качестве примера используйте [этот туториал](https://www.instructables.com/Slide-Switch-With-Arduino-Uno-R3/).

### Что нужно {#requirements}

- (x2) устройства Meshtastic (одно может быть подключено к локальному компьютеру, второе — просто запитано; к нему подключается светодиод)
- (x2) провода (чёрный и жёлтый; цвета любые, обычно чёрный — земля)
- (x1) светодиод
- (x1) резистор 220Ω (желательно)
- (x1) макетная плата (опционально)

### Подготовка {#preparation}

1. Отключите удалённое устройство от питания (battery/usb)
2. Подключите резистор к длинному (плюсовому) выводу светодиода, а к другому концу резистора — жёлтый провод
3. Подключите другой конец жёлтого провода к GPIO, который не конфликтует с устройством (например, для TLoraV1 можно использовать GPIO21)
4. Подключите чёрный провод "земли" от пина GND устройства (например, для TLoraV1 — крайний пин рядом с кнопкой RST) к короткому (минусовому) выводу светодиода
5. Включите питание устройства

### Проверка {#validation}

По умолчанию пин может быть "off" или "on" (чаще всего "off"). См. команды ниже. В примере с GPIO21 маска — `0x200000`.

![T-Lora v1 со светодиодом на GPIO 21](/img/LED_on_TLoraV1.webp)