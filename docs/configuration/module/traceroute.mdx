---
id: traceroute
title: Использование модуля Traceroute
sidebar_label: Traceroute
description: Модуль traceroute помогает понять маршрут сообщения до конечного узла по Mesh
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import ReactPlayer from "react-player";
import { Icon } from "@iconify/react";

## Обзор {#overview}

Из-за ограниченной пропускной способности LoRa Meshtastic не хранит путь сообщения по узлам до назначения. Начиная с прошивки 2.0.8, есть модуль Traceroute, который это показывает.

Отслеживаются только те узлы, которые знают ключ шифрования вашего Channel. Учтите, из-за ретрансляций сообщение может прийти по разным маршрутам. Модуль фиксирует хопы первого пакета с запросом traceroute, который дошёл до узла-получателя.

Для работы нужна прошивка 2.0.8 или новее.

Начиная с версии прошивки ≥ 2.5, записывается маршрут обратно к источнику, а также отношение сигнал/шум (SNR) для каждого звена. Узлы со старой прошивкой или те, что не могут расшифровать traceroute, будут показаны как "Unknown" (ID равен 4294967295 или 0xFFFFFFFF в hex), если все узлы на пути используют прошивку не ниже 2.3.12.

<div style={{ maxWidth: "800px", margin: "auto" }}>
  <ReactPlayer
    url="https://youtu.be/PKUmaELKaUo"
    controls
    width="100%"
    height="400px"
  />
</div>

## Поведение репитеров {#repeater-behavior}

Репитеры появятся в логе traceroute, если у них есть ключ шифрования, но если их нет в списке узлов, в некоторых приложениях они могут отображаться как "Unknown".

## Поддержка Traceroute в клиентах {#traceroute-module-client-availability}

<Tabs
  groupId="settings"
  defaultValue="apple"
  values={[
    {
      label: (
        <>
          <Icon icon="mdi:android" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Android
        </>
      ),
      value: "android",
    },
    {
      label: (
        <>
          <Icon icon="mdi:apple" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Apple
        </>
      ),
      value: "apple",
    },
    {
      label: (
        <>
          <Icon icon="mdi:terminal" height="1.5rem" style={{ marginRight: "0.25rem" }} /> CLI
        </>
      ),
      value: "cli",
    },
    {
      label: (
        <>
          <Icon icon="mdi:internet" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Web
        </>
      ),
      value: "web",
    },
  ]}>

<TabItem value="android">

#### Android

В списке узлов сделайте долгое нажатие на целевом узле и выберите 'Traceroute' — запрос отправится. В зависимости от числа хопов это может занять время. Результат появится во всплывающем окне.

</TabItem>
<TabItem value="apple">

#### Apple

В списке узлов сделайте долгое нажатие на целевом узле и выберите 'Trace Route' — запрос отправится. В зависимости от числа хопов это может занять время. На iOS/iPadOS 17 и macOS 14+ результаты будут в Trace Route Log этого узла в его карточке. В ранних версиях смотрите Settings > Logging > Mesh Log.

</TabItem>
<TabItem value="cli">

#### CLI

Убедитесь, что версия CLI не ниже 2.0.6. Затем выполните команду:

```shell title="Команда CLI для traceroute"
meshtastic --traceroute 'destinationId'
```

В параметре `destinationId` укажите ID нужного узла назначения — его можно получить из `meshtastic --nodes`. В зависимости от ОС могут понадобиться кавычки вокруг ID. Будет отправлено специальное сообщение для трассировки хопов. Например, вывод может быть таким:

```shell title="Traceroute от !25048234 до !bff18ce4"
meshtastic --traceroute '!bff18ce4'
Connected to radio
Sending traceroute request to !bff18ce4 (this could take a while)
Route traced towards destination:
!25048234 --> !ba4bf9d0 (6.0dB) --> !bff18ce4 (-3.5dB)
Route traced back to us:
!bff18ce4 --> !ba4bf9d0 (-2.75dB) --> !25048234 (5.25dB)
```

Первый ID — это исходное устройство, к которому подключён CLI. Как показано выше, пакет прошёл через один промежуточный узел до назначения и обратно.

</TabItem>
<TabItem value="web">

#### Web

Выберите узел в списке и нажмите кнопку "Route" в правом верхнем углу — отправится запрос traceroute к выбранному узлу. Результат будет показан на странице сообщений этого узла.

</TabItem>
</Tabs>