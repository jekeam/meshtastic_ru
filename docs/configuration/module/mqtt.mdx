---
id: mqtt
title: Настройка модуля MQTT
sidebar_label: MQTT
description: Как управлять MQTT‑сервером, шифрованием и др. на устройстве Meshtastic.
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import { Icon } from "@iconify/react";

Если устройство подключено к интернету по Wi‑Fi или Ethernet, можно включить пересылку пакетов на MQTT‑сервер. Это позволит пользователям локального Mesh общаться с пользователями в интернете. Нужно включить один или несколько Channel как uplink и/или downlink для передачи пакетов из/в вашу сеть (см. [channels](/docs/configuration/radio/channels#downlink-enabled)).

Параметры модуля MQTT: Enabled, Server Address, Username, Password, Encryption Enabled, JSON Enabled, TLS Enabled, Root Topic, Client Proxy Enabled, Map Reporting Enabled (с Position Precision и Publish Interval) и Okay to MQTT. Настройка модуля MQTT отправляется админ‑сообщением `ConfigModule.MQTT` protobuf.

## Настройки {#settings}

## Параметры модуля MQTT {#mqtt-module-config-values}

### Включено {#enabled}

Включает модуль MQTT.

### Адрес сервера {#server-address}

Сервер для подключения по MQTT. Если не задан, будет использован публичный сервер по умолчанию.

### Имя пользователя {#username}

Имя пользователя для MQTT‑сервера (обычно нужно для собственного сервера). Для кастомного сервера используется даже если пусто. Для публичного сервера по умолчанию — только если задано, иначе устройство применит стандартное имя.

### Пароль {#password}

Пароль для MQTT (обычно нужен для кастомного сервера). Для кастомного сервера используется даже если пусто. Для сервера по умолчанию — только если задан, иначе устройство применит стандартный пароль.

### Включить шифрование {#encryption-enabled}

Отправлять на MQTT‑сервер зашифрованные или незашифрованные пакеты. Незашифрованные пакеты полезны для внешних систем, которые читают трафик Meshtastic.

Примечание: Все сообщения отправляются в брокер MQTT без шифрования, если эта опция выключена, даже если в uplink‑каналах заданы ключи шифрования.

### Включить JSON {#json-enabled}

:::note заметка
JSON не поддерживается на платформе nRF52.
:::

Включает отправку/прием JSON‑пакетов по MQTT. Эти пакеты не шифруются, но их легко интегрировать с системами, читающими JSON.

### Включить TLS {#tls-enabled}

Если включено — устанавливается защищенное соединение по TLS.

### Корневой топик {#root-topic}

Root topic для MQTT‑сообщений. Полезно, если вы используете один MQTT‑сервер для нескольких сетей Meshtastic и хотите разделить их через ACL.

### Включить Client Proxy {#client-proxy-enabled}

Если включено — устройство использует сетевое подключение клиента (например, телефона) для доступа к MQTT‑серверу. Если выключено — используется сеть самого устройства, которую нужно включить в [настройках сети](/docs/configuration/radio/network).

### Включить отчеты для карты {#map-reporting-enabled}

Доступно с версии прошивки 2.3.2.
Если включено, ваш узел периодически отправляет незашифрованный отчет для карты на MQTT‑сервер для отображения на онлайн‑картах, поддерживающих этот пакет. Отчет содержит:

- Длинное и короткое имя узла и его ID;
- Позицию узла (с настраиваемой точностью) и высоту;
- Модель железа узла и [роль](/docs/configuration/radio/device/#roles);
- Версию прошивки узла;
- LoRa‑регион узла, пресет модема и имя основного Channel;
- Доступен ли узел на дефолтном Channel с известным ключом;
- Число локальных online‑узлов (слышанных за последние 2 часа, без тех, что через MQTT).

#### Точность позиции в отчете карты {#map-report-position-precision}

Точность позиции в отчете карты. По умолчанию максимум ~1459 м отклонения.

#### Интервал публикации отчета карты {#map-report-publish-interval}

Как часто публиковать отчет на MQTT, в секундах. По умолчанию 3600 с (1 час) и это же минимальное значение.

## Где доступна настройка модуля MQTT {#mqtt-module-config-client-availability}

<Tabs
  groupId="settings"
  defaultValue="apple"
  values={[
    {
      label: (
        <>
          <Icon icon="mdi:android" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Android
        </>
      ),
      value: "android",
    },
    {
      label: (
        <>
          <Icon icon="mdi:apple" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Apple
        </>
      ),
      value: "apple",
    },
    {
      label: (
        <>
          <Icon icon="mdi:terminal" height="1.5rem" style={{ marginRight: "0.25rem" }} /> CLI
        </>
      ),
      value: "cli",
    },
    {
      label: (
        <>
          <Icon icon="mdi:internet" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Web
        </>
      ),
      value: "web",
    },
  ]}>
<TabItem value="android">

#### Android

:::info инфо

Опции MQTT доступны на Android.

1. Откройте приложение Meshtastic
2. Перейдите: **Вертикальное многоточие (3 dots top right) > Конфигурация радио > MQTT**

:::

</TabItem>
<TabItem value="apple">

#### Apple

:::info инфо

Все опции MQTT доступны на iOS, iPadOS и macOS: Настройки > Конфигурация модуля > MQTT.

:::

</TabItem>
<TabItem value="cli">

#### CLI

:::info инфо

В Python CLI доступны следующие параметры:

:::

|        Параметр         | Допустимые значения |         По умолчанию         |
| :---------------------: | :-----------------: | :--------------------------: |
|      mqtt.enabled       |   `true`, `false`   |          `false`             |
|      mqtt.address       |      `string`       | `mqtt.meshtastic.org`        |
|     mqtt.username       |      `string`       |        `meshdev`             |
|     mqtt.password       |      `string`       |        `large4cats`          |
| mqtt.encryption_enabled |   `true`, `false`   |          `false`             |
|   mqtt.json_enabled     |   `true`, `false`   |          `false`             |
|    mqtt.tls_enabled     |   `true`, `false`   |          `false`             |
|       mqtt.root         |      `string`       |                              |
| mqtt.proxy_to_client_enabled | `true`, `false` |          `false`             |
| mqtt.map_reporting_enabled  | `true`, `false`  |          `false`             |

:::tip подсказка

Так как устройство перезагружается после каждой команды из CLI, при настройке нескольких значений в одном разделе удобнее отправить их одной цепочкой.

```shell title="Пример:"
meshtastic --set mqtt.enabled true --set mqtt.json_enabled true
```

:::

```shell title="Включить/выключить модуль MQTT"
meshtastic --set mqtt.enabled true
meshtastic --set mqtt.enabled false
```

```shell title="Включить/выключить MQTT JSON"
meshtastic --set mqtt.json_enabled true
meshtastic --set mqtt.json_enabled false
```

</TabItem>
<TabItem value="web">

#### Web

:::info инфо
Все опции модуля MQTT доступны в Web UI.
:::

</TabItem>
</Tabs>

## Подключение к публичному серверу по умолчанию {#connect-to-the-default-public-server}

:::important важно
На публичном сервере дефолтный Channel (LongFast) обычно очень загружен. Устройство может перегружаться и работать нестабильно. Если возникают проблемы — используйте другой Channel или свой MQTT‑сервер.
:::

<Tabs
  groupId="settings"
  defaultValue="apple"
  values={[
    {
      label: (
        <>
          <Icon icon="mdi:android" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Android
        </>
      ),
      value: "android",
    },
    {
      label: (
        <>
          <Icon icon="mdi:apple" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Apple
        </>
      ),
      value: "apple",
    },
    {
      label: (
        <>
          <Icon icon="mdi:terminal" height="1.5rem" style={{ marginRight: "0.25rem" }} /> CLI
        </>
      ),
      value: "cli",
    },
    {
      label: (
        <>
          <Icon icon="mdi:internet" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Web
        </>
      ),
      value: "web",
    },
  ]}>

<TabItem value="android">

#### Android

##### 1. Включить модуль MQTT {#enable-the-mqtt-module-android}

Перейдите: Вертикальное многоточие (3 dots top right) > Конфигурация радио > MQTT. Включите тумблер **MQTT enabled** и нажмите **Send**.

[![Настройки MQTT](/img/modules/mqtt/android_mqtt_encryption_sm.webp)](/img/modules/mqtt/android_mqtt_encryption.webp)

_Опционально:_ чтобы использовать интернет телефона для обмена через веб, включите **MQTT Client Proxy** и пропустите шаг «Настроить сеть» ниже.

[![Client Proxy](/img/modules/mqtt/android_mqtt_proxy_sm.webp)](/img/modules/mqtt/android_mqtt_proxy_encryption.webp)

##### 2. Включить uplink и downlink у канала {#enable-channel-uplink-downlink-android}

Перейдите: Вертикальное многоточие (3 dots top right) > Конфигурация радио > Channels > LongFast. Включите тумблеры **Uplink enabled** и **Downlink enabled**, затем нажмите **Save** и **Send**.

[![Настройки канала](/img/modules/mqtt/android_channel_sm.webp)](/img/modules/mqtt/android_channel.webp)

##### 3. Настроить сеть {#configure-network-settings-android}

Перейдите: Вертикальное многоточие (3 dots top right) > Конфигурация радио > Network. Включите тумблер **WiFi enabled**, введите **SSID** и **PSK** своей сети, затем нажмите **Send**.

[![Настройки сети](/img/modules/mqtt/android_network_sm.webp)](/img/modules/mqtt/android_network.webp)

</TabItem>
<TabItem value="apple">

#### Apple

##### 1. Включить модуль MQTT {#enable-the-mqtt-module-apple}

Перейдите в Settings > MQTT. Включите тумблер MQTT enabled и нажмите **Save**.

[![Настройки MQTT 1](/img/modules/mqtt/apple_mqtt_1_encryption_sm.webp)](/img/modules/mqtt/apple_mqtt_1_encryption.webp)
[![Настройки MQTT 2](/img/modules/mqtt/apple_mqtt_2_sm.webp)](/img/modules/mqtt/apple_mqtt_2.webp)

_Опционально:_ чтобы использовать интернет телефона для обмена через веб, включите **MQTT Client Proxy** и пропустите шаг «Настроить сеть» ниже.

[![Client Proxy](/img/modules/mqtt/apple_mqtt_1_proxy_sm.webp)](/img/modules/mqtt/apple_mqtt_1_proxy_encryption.webp)

##### 2. Включить uplink и downlink у канала {#enable-channel-uplink-downlink-apple}

Перейдите в Settings > Channels > Primary Channel. Включите тумблеры **Uplink enabled** и **Downlink enabled** — нажмите **Save**.

[![Настройки канала](/img/modules/mqtt/apple_channel_sm.webp)](/img/modules/mqtt/apple_channel.webp)

##### 3. Настроить сеть {#configure-network-settings-apple}

Перейдите в Settings > Network. Включите тумблер **WiFi enabled** — введите **SSID** и **PSK** своей сети — нажмите **Save**.

[![Настройки сети](/img/modules/mqtt/apple_network_sm.webp)](/img/modules/mqtt/apple_network.webp)

</TabItem>
<TabItem value="cli">

#### CLI

##### 1. Включить модуль MQTT {#enable-the-mqtt-module-cli}

```shell
meshtastic --set mqtt.enabled true
```

##### 2. Включить uplink и downlink у канала {#enable-channel-uplink-downlink-cli}

```shell
meshtastic --ch-set uplink_enabled true --ch-index 0
meshtastic --ch-set downlink_enabled true --ch-index 0
```

или одной командой:

```shell
meshtastic --ch-set uplink_enabled true --ch-index 0 --ch-set downlink_enabled true --ch-index 0
```

##### 3. Настроить сеть {#configure-network-settings-cli}

```shell
meshtastic --set network.wifi_enabled true
meshtastic --set network.wifi_ssid "your network"
meshtastic --set network.wifi_psk yourpassword
```

или одной командой:

```shell
meshtastic --set network.wifi_enabled true --set network.wifi_ssid "your network" --set network.wifi_psk yourpassword
```

</TabItem>
<TabItem value="web">

#### Web

##### 1. Включить модуль MQTT {#enable-the-mqtt-module-web}

Перейдите в Config > Module Config > MQTT — включите тумблер MQTT enabled — нажмите значок **Save**.

[![Настройки MQTT](/img/modules/mqtt/web_mqtt_encryption_sm.webp)](/img/modules/mqtt/web_mqtt_encryption.webp)

_Опционально:_ чтобы использовать интернет клиента для обмена через веб, включите **Proxy to Client Enabled** и пропустите шаг «Настроить сеть» ниже.

[![Client Proxy](/img/modules/mqtt/web_mqtt_proxy_sm.webp)](/img/modules/mqtt/web_mqtt_proxy_encryption.webp)

:::caution осторожно

Хотя этот пункт может быть виден в UI, Client Proxy пока не работает в Web‑клиенте.

:::

##### 2. Включить uplink и downlink у канала {#enable-channel-uplink-downlink-web}

Перейдите в Channels > Primary: включите тумблеры **Uplink Enabled** и **Downlink Enabled** — нажмите значок **Save**.

[![Настройки канала](/img/modules/mqtt/web_channel_sm.webp)](/img/modules/mqtt/web_channel.webp)

##### 3. Настроить сеть {#configure-network-settings-web}

Перейдите в Настройки Раидо >Device > Network: включите тумблер **Enabled** — введите **SSID** и **PSK** своей сети — нажмите значок **Save**.

[![Настройки сети](/img/modules/mqtt/web_network_sm.webp)](/img/modules/mqtt/web_network.webp)

</TabItem>
</Tabs>