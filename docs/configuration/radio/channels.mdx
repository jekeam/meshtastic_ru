---
id: channels
title: "Настройка Channel"
sidebar_label: "Channels"
description: "Как настроить Channels на устройстве Meshtastic - приватные Channels, шифрование, MQTT и точность координат."
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import { Icon } from "@iconify/react";
import PositionPrecisionBits from "@site/docs/blocks/_position-precision-bits.mdx";
import QRCode from "@site/docs/blocks/_qr-code.mdx";

Опции Channel Config: Index, Roles и Settings. Channel Config отправляется админ-сообщением с `Channel` protobuf, который содержит `ChannelSettings` или `ModuleSettings` protobuf.

:::info инфо
**Channel Settings** (описаны на этой странице) не путать с [Modem Preset Settings](/docs/configuration/radio/lora#modem-preset)

[Modem Preset Settings](/docs/configuration/radio/lora#modem-preset) содержат конфиг модема (частоты, spreading factor, bandwidth и т.д.) для LoRa-радио. Эти настройки одинаковы для всех Channels и **не** могут отличаться по Channel.

**Channel Settings** содержат информацию для разделения групп сообщений, настройки опционального шифрования и включения/отключения обмена через интернет‑шлюзы. Эти настройки **уникальны** и задаются отдельно для каждого Channel.
:::

## Параметры Channel Config

### Index

Нумерация Channels начинается с 0 и заканчивается 7.

_Индексация_ не изменяется.

| Index | Channel | Default Role |          Назначение          |
| :---: | :-----: | :----------: | :--------------------------: |
|   0   |    1    |  `PRIMARY`   | Используется как `default` Channel |
|   1   |    2    |  `DISABLED`  |      Задаётся пользователем      |
|   2   |    3    |  `DISABLED`  |      Задаётся пользователем      |
|   3   |    4    |  `DISABLED`  |      Задаётся пользователем      |
|   4   |    5    |  `DISABLED`  |      Задаётся пользователем      |
|   5   |    6    |  `DISABLED`  |      Задаётся пользователем      |
|   6   |    7    |  `DISABLED`  |      Задаётся пользователем      |
|   7   |    8    |  `DISABLED`  |      Задаётся пользователем      |

:::note заметка
Между активными каналами (например, `PRIMARY` и `SECONDARY`) **нельзя** иметь `DISABLED`. Активные Channels должны идти подряд.
:::

### Role

Каждому Channel назначается одна из 3 ролей:

1. `PRIMARY` или `1`
   - Первый Channel, создаётся при первичной настройке.
   - Только один PRIMARY. Его нельзя отключить.
   - По умолчанию периодические передачи (позиция, телеметрия) идут через него.
2. `SECONDARY` или `2`
   - Можно менять ключ шифрования (PSK).
3. `DISABLED` или `0`
   - Channel недоступен для использования.
   - Настройки Channel сбрасываются к значениям по умолчанию.

:::note заметка
Хотя можно иметь другой PRIMARY и общаться по SECONDARY с тем же Name и PSK, хэш имени PRIMARY задаёт слот частоты LoRa, что определяет фактическую частоту в диапазоне.
Чтобы устройства с разными именами PRIMARY работали на одной частоте, явно задайте слот частоты LoRa.
:::

## Значения Channel Settings

Опции Channel Settings: Name, PSK, Downlink Enabled и Uplink Enabled. Channel Settings встраиваются в `Channel` protobuf как `ChannelSettings` и отправляются админ‑сообщением.

### Name

Короткий идентификатор Channel. _(< 12 bytes)_

|  Reserved Name  |                                                                                                                  Назначение                                                                                                                   |
| :-------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
| `""` (default)  |                                                                             Если на PRIMARY пусто, считается `default` Channel.                                                                              |
|     `admin`     | На Secondary имя `admin` (с учётом регистра) обозначает `admin` Channel для администрирования узлов по Mesh. Это Legacy-функция, см. [Remote Admin](docs/configuration/remote-admin.mdx). |

:::note заметка

Чтобы общаться на одном Channel с другими устройствами, имена Channel должны совпадать. Пример: если у вас `LongFast`, то у устройства собеседника тоже должен быть Channel с именем `LongFast`.

:::

### PSK

Ключ шифрования для приватных Channels.

Hex-байт `0x01` для PRIMARY `default` Channel.

Должен быть 0 байт (без шифрования), 16 байт (AES128) или 32 байта (AES256).

:::note заметка

Чтобы общаться на одном Channel с другими устройствами, PSK должен совпадать. Пример: если ваш Channel использует PSK по умолчанию `AQ==`, то у устройства собеседника должен быть Channel с тем же PSK.

:::

### Downlink Enabled

Если включено, сообщения, полученные из **public** интернет‑шлюза, будут пересылаться в локальный Mesh.

По умолчанию `false` для всех Channels.

### Uplink Enabled

Если включено, сообщения из Mesh будут отправляться в **public** интернет через настроенный шлюз любого узла.

По умолчанию `false` для всех Channels.

## Channel Module Settings

Опция Channel Module Settings: точность позиции. Эти настройки встраиваются в Channel protobuf как ModuleSettings и отправляются админ‑сообщением.

### Position Precision

`position_precision` управляет точностью координат, отправляемых по конкретному Channel. Полезно для приватности, если на некоторых каналах не нужна точная геопозиция.

`position_precision` — целое число от 0 до 32:

- 0 — координаты по этому Channel не отправляются.
- 32 — координаты с полной точностью.
- Значения между — число бит точности, соответствуют позициям из таблицы ниже.
- Публичный MQTT‑сервер отфильтровывает точные координаты, детали [здесь](https://meshtastic.org/docs/software/integrations/mqtt/#location-precision-filtering).

<PositionPrecisionBits />

В клиентах реализованы уровни точности с удобным диапазоном выбора. Полный диапазон значений можно задать через Python CLI. См. [Setting Position Precision](/docs/configuration/radio/channels/#setting-position-precision) для примеров в CLI.

## Доступность Channel Config в клиентах

<Tabs
  groupId="settings"
  defaultValue="apple"
  values={[
    {
      label: (
        <>
          <Icon icon="mdi:android" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Android
        </>
      ),
      value: "android",
    },
    {
      label: (
        <>
          <Icon icon="mdi:apple" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Apple
        </>
      ),
      value: "apple",
    },
    {
      label: (
        <>
          <Icon icon="mdi:terminal" height="1.5rem" style={{ marginRight: "0.25rem" }} /> CLI
        </>
      ),
      value: "cli",
    },
    {
      label: (
        <>
          <Icon icon="mdi:internet" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Web
        </>
      ),
      value: "web",
    },
  ]}>

<TabItem value="android">

#### Android

:::info инфо
Опции Channel Config доступны на Android.
:::
![Вкладки меню Android](/img/android/android-menu-channel.webp)

Вкладка Radio Configuration для типовых задач:

1. Показать QR-код и URL текущей конфигурации Channels.[^1]
2. Быстро создать или изменить PRIMARY Channel.
3. Выбрать modem preset для всех Channels, например `Long Range / Fast`.

[^1]:
    <QRCode />

См. [Android App Usage](/docs/software/android/usage#setup-a-channel) для подробной настройки PRIMARY Channel.

[![Редактор Channel](/img/android/android-channel-edit-sm.webp)](/img/android/android-channel-edit.webp)

Нажмите «Edit», чтобы открыть меню Channel:

1. Добавлять, удалять и изменять SECONDARY Channels
2. Создавать и менять ключи шифрования
3. Включать uplink и downlink для отдельных Channels
4. Position enabled
5. Precise location (если позиция включена)
6. Position precision (если точная геопозиция выключена)

</TabItem>

<TabItem value="apple">

#### Apple

:::info инфо

Редактор Channel доступен в iOS, iPadOS и macOS: Settings > Radio Configuration > Channels.

:::

</TabItem>

<TabItem value="cli">

#### CLI

:::info инфо
Все опции Channel Config доступны в python CLI. Примеры ниже:
:::

:::tip подсказка

Так как устройство перезагружается после каждой команды, при установке нескольких значений в одном разделе лучше объединять команды в одну строку.

```shell title="Пример:"
meshtastic --ch-set name "My Channel" --ch-set psk random --ch-set uplink_enabled true --ch-index 4
```

:::

##### Name

```shell title="Задать имя для PRIMARY Channel"
# без пробелов
meshtastic --ch-set name MyChannel --ch-index 0
# с пробелами
meshtastic --ch-set name "My Channel" --ch-index 0
```

##### PSK

Если используете Meshtastic для обмена приватными сообщениями, выбирайте `random`. Значения `default` или `simple` из таблицы ниже — это общедоступные ключи шифрования. Они входят в исходники Meshtastic, поэтому любой может прочитать такие сообщения. Подходят для тестов и публичных Channels.

|        Параметр        |                                        Поведение                                         |
| :--------------------: | :---------------------------------------------------------------------------------------: |
|         `none`         |                                    Отключить шифрование                                   |
|       `default`        |                 Шифрование по умолчанию (слабый общий ключ, не для приватности)          |
|        `random`        | Генерировать безопасный 256-битный ключ. Используйте для приватной связи. |
| `simple0`- `simple254` |                         Однобайтовое кодирование шифрования                              |

```shell title="Включить default-шифрование на PRIMARY Channel"
meshtastic --ch-set psk default --ch-index 0
```

```shell title="Включить случайный ключ на PRIMARY Channel"
meshtastic --ch-set psk random --ch-index 0
```

```shell title="Включить однобайтный ключ на PRIMARY Channel"
meshtastic --ch-set psk simple15 --ch-index 0
```

```shell title="Установить свой ключ на PRIMARY Channel"
meshtastic --ch-set psk 0x1a1a1a1a2b2b2b2b1a1a1a1a2b2b2b2b1a1a1a1a2b2b2b2b1a1a1a1a2b2b2b2b --ch-index 0
```

```shell title="Установить свой ключ на PRIMARY Channel (Base64)"
meshtastic --ch-set psk base64:puavdd7vtYJh8NUVWgxbsoG2u9Sdqc54YvMLs+KNcMA= --ch-index 0
```

:::tip подсказка
Скопируйте `base64`‑ключ (single channel) из вывода meshtastic --info. Не используйте omnibus (all channels) — это невалидный ключ.
:::

```shell title="Отключить шифрование на PRIMARY Channel"
meshtastic --ch-set psk none --ch-index 0
```

##### Uplink / Downlink

Для настройки шлюзов см. [MQTT](/docs/configuration/module/mqtt)

```shell title="Включить/выключить Uplink на PRIMARY Channel"
meshtastic --ch-set uplink_enabled true --ch-index 0
meshtastic --ch-set uplink_enabled false --ch-index 0
```

```shell title="Включить/выключить Downlink на SECONDARY Channel"
meshtastic --ch-set downlink_enabled true --ch-index 1
meshtastic --ch-set downlink_enabled false --ch-index 5
```

#### Настройка точности координат {#setting-position-precision}

:::info инфо

Это настройка на уровне Channel. Для конкретного Channel обязательно указывайте `--ch-index`, например `--ch-index 0` для PRIMARY или `--ch-index 1` для SECONDARY 1.

:::

```shell title="Установить точность 13 бит (≈ ±3 км)"
meshtastic --ch-set module_settings.position_precision 13 --ch-index 0
```

```shell title="Установить полную точность (32 бита)"
meshtastic --ch-set module_settings.position_precision 32 --ch-index 1
```

</TabItem>

<TabItem value="web">

#### Web

:::info инфо
Все опции Channel Config доступны в Web UI.
:::

</TabItem>
</Tabs>
