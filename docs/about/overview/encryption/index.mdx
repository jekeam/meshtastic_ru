---
id: encryption
title: Шифрование в Meshtastic
sidebar_label: Шифрование
slug: /overview/encryption
sidebar_position: 3
description: "Как работает шифрование в Meshtastic: опциональная AES256‑защита на уровне всей сети для связи без инфраструктуры, защищает от пассивной прослушки."
---

## Объяснение {#explanation}

Meshtastic шифрует полезную нагрузку каждого пакета (AES256‑CTR) при передаче по LoRa, ключ свой для каждого [Channel](/docs/configuration/radio/channels/). [Заголовок пакета](/docs/overview/mesh-algo/#layer-1-unreliable-zero-hop-messaging) всегда отправляется открытым — это позволяет узлам ретранслировать пакеты, даже если они не могут их расшифровать. Это можно отключить, выбрав другой [режим ретрансляции](/docs/configuration/radio/device#rebroadcast-mode).

По умолчанию у вас один основной Channel, он зашифрован простым известным ключом ("AQ=="), поэтому для нормального шифрования вы должны сначала изменить этот ключ или создать новый Channel и поделиться им с теми, с кем хотите общаться. Но без Channel с дефолтным ключом вы не сможете общаться с устройствами, которые всё ещё на нём.

Direct Messages (DM) теперь шифруются с использованием Public Key Cryptography (PKC). У каждого Node есть уникальная пара открытого/закрытого ключей, и DM шифруется публичным ключом получателя. Это гарантирует, что расшифровать может только получатель своим приватным ключом. Дополнительно сообщения подписываются приватным ключом отправителя, что позволяет проверять подлинность отправителя и целостность сообщения.

Все периодические широковещательные сообщения (позиция, телеметрия, traceroute и т.п.), которые устройство отправляет само, идут через основной Channel и шифруются его ключом.

Перед отправкой в клиентское приложение по BLE, Serial, Wi‑Fi/Ethernet устройство расшифровывает полезную нагрузку. Для MQTT можно [выбрать](/docs/configuration/module/mqtt#encryption-enabled), отправлять зашифрованный или открытый payload.

## Это так же безопасно, как Wi‑Fi WPA3, HTTPS TLS 1.3 или Signal? {#is-it-as-secure-as-wi-fi-wpa3-https-tls1-3-or-signal}

**Нет**.

[WPA3](https://en.wikipedia.org/wiki/WPA3), [TLS1.3](https://en.wikipedia.org/wiki/TLS1.3), [Signal](https://en.wikipedia.org/wiki/Signal_Protocol) и Meshtastic могут использовать AES256. Но AES — это лишь одна шестерёнка в современной системе шифрования. Ниже — основные функции, которых нет в Meshtastic.

### Perfect Forward Secrecy (PFS) {#perfect-forward-secrecy}

[**P**erfect-**F**orward-**S**ecrecy, также **PFS**](https://en.wikipedia.org/wiki/Forward_secrecy) означает, что _прошлые_ коммуникации и вообще всё, что было _пассивно перехвачено_, нельзя расшифровать **_даже если ключ скомпрометирован_**.

Это значит, что Meshtastic уязвим к атакам [**« Harvest now, Decrypt later »**](https://en.wikipedia.org/wiki/Harvest_now,_decrypt_later). **Одна эта атака не позволяет расшифровать сообщения**; она опирается на другой сбой, при котором утечёт ключ Channel, например:

- Случайно поделились ключом Channel не с тем человеком.
- Один из ваших узлов украден.
- Неизвестная ошибка раскрыла ключ Channel атакующему.

Другие протоколы, например _неправильно настроенный TLS1.2_, сильнее страдают от Harvest now, Decrypt later, потому что их ключи будут сломаны в ближайшем будущем квантовыми компьютерами, и при этом они тоже не обеспечивают PFS.

AES256 в Meshtastic считается квантоустойчивым[^1], но обмен ключами для DM — нет, потому что текущие квантоустойчивые схемы не помещаются в LoRa‑пакеты или наше IoT‑железо; реалистичные векторы атак — случайная утечка ключей Channel, потеря узлов и возможные будущие квантовые атаки на обмен ключами для DM.

[^1]: О квантовой стойкости AES256 см. [этот вопрос на stackoverflow с обсуждением и двумя хорошими ответами](https://crypto.stackexchange.com/q/6712) и раздел [FAQ NIST по Post-Quantum](https://csrc.nist.gov/projects/post-quantum-cryptography/faqs) «To protect against the threat of quantum computers, should we double the key length for AES now? (added 11/18/18)»

#### Рекомендации для пользователей приватных Channel {#recommendations-for-users-using-private-channels}

- Не настраивайте приватные Channel на узлах без присмотра. Узлы ретранслируют трафик Meshtastic, даже если не могут его расшифровать. Ваши автономные роутеры не должны иметь приватный PSK, так как получить физический доступ и вытащить ключ Channel легко.
- Помните, всё, что отправлено в Channel, можно сохранить и расшифровать позже любым, кто получит доступ к ключу, даже если вы удалили сообщения локально.
- Периодически меняйте ключи Channel.

#### Изменения с релиза Firmware 2.5.0 {#changes-since-2-5-0-firmware-release}

- Direct Messages теперь защищены PKC при обмене между устройствами на v2.5.0 или новее и после обмена ключами; переписка с прошивками 2.4.3 и старше не защищена.
- Admin Messages между двумя узлами на v2.5.0 или новее теперь защищены, добавлена защита от relay‑атак.

### Целостность {#integrity}

Целостность — это гарантия, что сообщения нельзя изменить без ключа.

Meshtastic не проверяет целостность сообщений Channel на предмет подмены (подробности в [issue #4030](https://github.com/meshtastic/firmware/issues/4030)).

#### Рекомендации {#recommendations}

- Помните, что при применении атаки известного открытого текста любой _может_ отправлять сообщения в Channel, даже если ключ Channel приватный и защищён.
- Разработчикам сторонних приложений, интегрирующих Meshtastic: добавляйте криптографический MAC поверх содержимого сообщения и PSK. Мы также рассматриваем [режим Channel на AEAD, который обеспечит это нативно](https://github.com/meshtastic/firmware/issues/4030).

#### Изменения с релиса Firmware 2.5.0 {#changes-since-2-5-0-firmware-release-1}

- Целостность сообщений проверяется для Direct Messages и Admin Control при обмене между устройствами на прошивке v2.5.0 или новее.

### Аутентификация {#authentication}

Аутентификация — это когда узлы заявляют, кто они в сети. В Meshtastic этого нет, поэтому, имея доступ к ключу Channel, легко выдавать себя за другого.

Так как ID узлов основаны на аппаратном [MAC‑адресе](https://en.wikipedia.org/wiki/MAC_address), который зашит производителем.

Некоторые сети, такие как [Yggdrasil](https://yggdrasil-network.github.io/), [cjdns](https://github.com/cjdelisle/cjdns) или [libp2p](https://libp2p.io/), используют [пары открытый/закрытый ключ](https://en.wikipedia.org/wiki/Public-key_cryptography), где публичный ключ — это идентичность узла. Это увеличивает размер сообщений и/или требует интерактивного рукопожатия.

#### Рекомендации {#recommendations-1}

- Помните, поле отправителя носит справочный характер, и любой с доступом к ключу Channel может легко его подделать.

#### Изменения с релиза Firmware 2.5.0 {#changes-since-2-5-0-firmware-release-2}

- Вышеописанное теперь относится только к группам/Channel, т.к. DM защищены при обмене между устройствами на 2.5 или новее; переписка с устройствами на 2.4 и старше не получает эту дополнительную аутентификацию.

## Direct Messages {#direct-messages}

Direct Messages (DM) теперь реализованы с использованием Public Key Cryptography (PKC). Это существенно повышает безопасность по сравнению с прежним шифрованием на уровне Channel:

- Шифрование сообщений: каждый DM шифруется публичным ключом получателя, так что расшифровать может только он своим приватным ключом.
- Цифровые подписи: сообщения подписываются приватным ключом отправителя, получатель может проверить подлинность отправителя и целостность сообщения.

### До релиза Firmware 2.5.0 {#prior-to-2-5-0-firmware-release}

Ранее DM были обычными сообщениями Channel с установленным protobuf‑полем `to`. Это означало, что любой в Channel мог читать ваши прямые сообщения. С PKC эта проблема решена — прочитать их может только адресат.

### Рекомендации {#recommendations-2}

- Хотя PKC заметно усиливает безопасность DM, всё равно не стоит делиться чувствительной информацией без проверки публичного ключа получателя.

## Admin Messages {#admin-messages}

Admin Messages/Control теперь защищены улучшенными средствами безопасности, чтобы критические операции в сети были ещё надёжнее.

- Более сильное шифрование: Admin Messages теперь используют продвинутые методы шифрования, доступ к ним получают только адресаты.
- Session ID: каждая административная сессия получает уникальный Session ID, который помогает предотвратить несанкционированный доступ и исключает подмену/повтор сообщений.

### До релиза Firmware 2.5.0 {#prior-to-2-5-0-firmware-release-1}

Ранее админ‑сообщения были менее защищены, теперь же они значительно лучше защищены от потенциальных и replay‑атак.

### Рекомендации {#recommendations-3}

- Держите устройства на последней прошивке, чтобы получить улучшенную защиту.
- Регулярно мониторьте сеть на необычную активность для поддержания высокого уровня безопасности.