---
id: cli-script
title: Прошивка через CLI
sidebar_label: CLI-скрипт (для опытных)
sidebar_position: 3
description: Как прошить Meshtastic на устройства с ESP32 через CLI.
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import { Icon } from "@iconify/react";
import Link from "@docusaurus/Link";

:::Осторожно
Не включайте радио без подключённой антенны — можно повредить радиочип!
:::

Перед прошивкой сначала проверьте подключение устройства. Ниже — шаги для проверки и, при необходимости, установки драйверов. Если пришлось ставить драйверы, после установки перезагрузите компьютер.

:::Заметка
Плата [T-Beam 0.7](/docs/hardware/devices/lilygo/tbeam/?t-beam=0.7) — ранняя версия T-Beam. Из-за изменений в следующих ревизиях ей нужен отдельный файл firmware, отличный от других T-Beam.

Правильный файл: `firmware-tbeam0.7-X.X.X.xxxxxxx.bin`. Файл `firmware-tbeam-X.X.X.xxxxxxx.bin` несовместим. Для остальных плат [T-Beam](/docs/hardware/devices/lilygo/tbeam) смотрите раздел ресурсов и выбирайте подходящий вариант.
:::

## Инструкция по CLI

### Установить необходимые инструменты

<Tabs
  groupId="operating-system"
  defaultValue="windows"
  values={[
    {
      label: (
        <>
          <Icon icon="mdi:tux" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Linux
        </>
      ),
      value: "linux",
    },
    {
      label: (
        <>
          <Icon icon="mdi:apple" height="1.5rem" style={{ marginRight: "0.25rem" }} /> macOS
        </>
      ),
      value: "macos",
    },
    {
      label: (
        <>
          <Icon icon="mdi:microsoft" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Windows
        </>
      ),
      value: "windows",
    },
  ]}>

<TabItem value="linux">

#### Linux

Проверьте, установлены ли `python3` и `pip`, командой:

```shell
python3 --version
pip3 --version
```

Если `python3` не установлен, поставьте:

```shell
sudo apt-get update
sudo apt-get install python3
```

Если нет `pip`, поставьте:

```shell
sudo apt-get install python3-pip
```

  </TabItem>
  <TabItem value="macos">

#### macOS

В OS X есть `Python 2.7`, но нет `pip`. Ниже показано, как через Homebrew поставить `python3`, который включает `pip3`. В macOS используйте `pip3`, а не `pip`.

:::Заметка
Проверьте, установлен ли Homebrew:

```shell
brew -v
```

Если нет — следуйте инструкциям на [сайте Homebrew](https://brew.sh) перед продолжением.
:::

Проверьте, установлены ли `python3` и `pip`:

```shell
python3 --version
pip3 --version
```

Если нет `python3`, установите:
Install Python3

```shell
brew install python3
```

Проверьте, что вместе с `python3` установился `pip3`:

```shell
pip3 -v
```

  </TabItem>
  <TabItem value="windows">

#### Windows

- Скачайте и установите [Python](https://www.python.org). При установке отметьте `Add Python X.Y to PATH`.
- Скачайте и установите [Gitbash](https://gitforwindows.org) (или другой shell) и дальше выполняйте команды в нём.

:::Заметка
Проверьте установку `python` и `pip` командами:

```shell
py --version
```

```shell
pip --version
```

:::

  </TabItem>
</Tabs>

### Установить `esptool`

```shell
pip3 install --upgrade esptool
```

### Проверка связи с чипом

<Tabs
  groupId="operating-system"
  defaultValue="windows"
  values={[
    {
      label: (
        <>
          <Icon icon="mdi:tux" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Linux
        </>
      ),
      value: "linux",
    },
    {
      label: (
        <>
          <Icon icon="mdi:apple" height="1.5rem" style={{ marginRight: "0.25rem" }} /> macOS
        </>
      ),
      value: "macos",
    },
    {
      label: (
        <>
          <Icon icon="mdi:microsoft" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Windows
        </>
      ),
      value: "windows",
    },
  ]}>

<TabItem value="linux">

#### Linux

:::Важно
В Linux может понадобиться явно вызывать esptool как .py. Используйте `esptool.py chip_id`.
:::

</TabItem>
<TabItem value="macos">

#### macOS

:::Важно
В macOS может понадобиться явно вызывать esptool как .py. Используйте `esptool.py chip_id`.
:::

</TabItem>
<TabItem value="windows">

#### Windows

:::Внимание
В Windows нужно явно вызывать esptool как .py. Используйте `esptool.py chip_id`.
:::

  </TabItem>
</Tabs>

Подключите радио к компьютеру USB‑кабелем для данных. Проверьте, что устройство отвечает, командой:

```shell title="Command"
esptool chip_id
```

```shell title="Expected Output"
# You should see a result similar to this:
mydir$ esptool chip_id
esptool.py v2.6
Found 2 serial ports
Serial port /dev/ttyUSB0
Connecting....
Detecting chip type... ESP32
Chip is ESP32D0WDQ6 (revision 1)
Features: WiFi, BT, Dual Core, 240MHz, VRef calibration in efuse, Coding Scheme None
MAC: 24:6f:28:b5:36:71
Uploading stub...
Running stub...
Stub running...
Warning: ESP32 has no Chip ID. Reading MAC instead.
MAC: 24:6f:28:b5:36:71
Hard resetting via RTS pin...
```

### Скачать Firmware

1. Откройте [страницу загрузок Meshtastic](/downloads) и скачайте свежую версию firmware.
2. Прокрутите до раздела **Firmware** и выберите вариант под ваши задачи:
- **Download Stable**: стабильные, проверенные релизы.
- **Download Alpha**: свежие экспериментальные сборки с новыми фичами.
3. На странице релиза GitHub разверните раздел "Assets". Найдите подходящую firmware по архитектуре (например, `firmware-esp32s3` для устройств на ESP32-S3, таких как Heltec V3).
4. Скачайте файл и запомните путь (обычно `~/Downloads`).

### Перейти в каталог с Firmware

1. Откройте терминал и перейдите (`cd`) в папку, куда скачали firmware. Имя папки обычно совпадает с архитектурой и версией из zip. Например:

```shell title="Example"
cd ~/Downloads/firmware-esp32s3-X.X.X.xxxxxxx/
```

:::Заметка
Замените `esp32s3` и номер версии на соответствующие вашему файлу.
:::

### Установка/обновление Firmware

Дальше следуйте инструкциям для вашей ОС, чтобы установить или обновить firmware для вашей платы:

:::Осторожно
Внимательно выбирайте файл firmware для вашей платы. Например, популярная 'T-BEAM' от TTGO — это не 'TTGO-Lora' (это другая плата). Не ставьте сборку 'TTGO-Lora' на T-BEAM — работать не будет. Если прошить не тот файл, процесс может «успешно» завершиться, но устройство станет неотзывчивым (экран, если есть, будет пустым). Попробуйте прошить корректную версию. Учтите, что хотя устройства довольно живучие, при неверных настройках GPIO есть риск повредить радиомодуль и периферию.
:::

<Tabs
  groupId="operating-system"
  defaultValue="windows"
  values={[
    {
      label: (
        <>
          <Icon icon="mdi:tux" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Linux
        </>
      ),
      value: "linux",
    },
    {
      label: (
        <>
          <Icon icon="mdi:apple" height="1.5rem" style={{ marginRight: "0.25rem" }} /> macOS
        </>
      ),
      value: "macos",
    },
    {
      label: (
        <>
          <Icon icon="mdi:microsoft" height="1.5rem" style={{ marginRight: "0.25rem" }} /> Windows
        </>
      ),
      value: "windows",
    },
  ]}>

<TabItem value="linux">

#### Linux

##### Установка

```shell title="Command"
./device-install.sh -f firmware-BOARD-VERSION.bin
```

##### Обновление

```shell title="Command"
./device-update.sh -f firmware-BOARD-VERSION-update.bin
```

  </TabItem>
  <TabItem value="macos">

#### macOS

##### Установка

```shell title="Command"
./device-install.sh -f firmware-BOARD-VERSION.bin
```

##### Обновление

```shell title="Command"
./device-update.sh -f firmware-BOARD-VERSION-update.bin
```

  </TabItem>
  <TabItem value="windows">

#### Windows

##### Установка

```shell title="Command"
device-install.bat -f firmware-BOARD-VERSION.bin
```

##### Обновление

```shell title="Command"
device-update.bat -f firmware-BOARD-VERSION-update.bin
```

  </TabItem>
</Tabs>

Используйте опцию `--web`, чтобы включить встроенный [Web Client](/docs/software/web-client/) при установке firmware.

## Подключение и начальная настройка

После прошивки Meshtastic можно перейти к первичной настройке.

<div className="indexCtasBody">
  <Link
    className={"button button--outline button--lg cta--button"}
    to={"/docs/getting-started/initial-config"}
  >
    Подключить и настроить устройство
  </Link>
</div>