---
id: swdio
title: SWDIO с Raspberry Pi
sidebar_label: SWDIO с Raspberry Pi
sidebar_position: 6
description: Инструкция по прошивке через SWDIO с Raspberry Pi.
---

Большинство устройств Meshtastic прошиваются по USB.
Но некоторые (например, Seeed WM1110 Dev Kit) требуют внешнего программатора по SWDIO.
Есть специализированные устройства вроде [RAKDAP1](https://msh.to/rakdap1/), а также [Segger J-Link](https://msh.to/segger-jlink) и [ST-Link](https://msh.to/st-link).
Но многим удобнее использовать Raspberry Pi.

Здесь — как использовать Raspberry Pi как SWDIO-программатор.

## Схема подключения

Сначала соедините два провода между Raspberry Pi и контактами SWDIO на вашем устройстве на базе nRF52.

Соедините GPIO 11 на Raspberry Pi с контактом CLK на устройстве Meshtastic.
Соедините GPIO 8 на Raspberry Pi с контактом DIO на устройстве Meshtastic.

Проверьте, что номера GPIO указаны верно.

Подайте питание на Raspberry Pi по USB.
Подайте питание на устройство Meshtastic.

## Установка OpenOCD

Для работы со SWDIO можно использовать OpenOCD.
Установите его на Raspberry Pi.

```
$ sudo apt update
$ sudo apt install libtool autoconf automake texinfo telnet gdb-multiarch git
$ git clone git://repo.or.cz/openocd.git
$ cd openocd/
$ ./bootstrap
$ ./configure --enable-bcm2835gpio
$ make -j4
$ sudo make install
```

## Проверка подключения

Перед прошивкой пробуем подключиться к устройству на nRF52 по SWDIO.
Все нужные конфиги уже есть в репозитории openocd.

```
$ openocd -f ./openocd/tcl/interface/raspberrypi-native.cfg -c "transport select swd" -f openocd/tcl/target/nrf52.cfg -s tcl
```

Первый флаг выбирает Raspberry Pi как хост, транспорт — SWDIO, последний флаг говорит, что подключаемся к чипу на nRF52.
Вы увидите что-то вроде:

```
Open On-Chip Debugger 0.12.0+dev-00633-gad87fbd1c
Licensed under GNU GPL v2
For bug reports, read
    http://openocd.org/doc/doxygen/bugs.html
srst_only separate srst_gates_jtag srst_push_pull connect_deassert_srst
swd
Info : Listening on port 6666 for tcl connections
Info : Listening on port 4444 for telnet connections
Info : BCM2835 GPIO JTAG/SWD bitbang driver
Info : clock speed 100 kHz
Info : SWD DPIDR 0x2ba01477
Info : [nrf52.cpu] Cortex-M4 r0p1 processor detected
Info : [nrf52.cpu] target has 6 breakpoints, 4 watchpoints
Info : [nrf52.cpu] Examination succeed
Info : [nrf52.cpu] starting gdb server on 3333
Info : Listening on port 3333 for gdb connections
Info : accepting 'telnet' connection on tcp/4444
```

Если видите “Error connecting DP: cannot read IDR”, скорее всего, провода подключены не туда.

## Где взять Firmware

См. инструкции для вашего устройства на странице [hardware](/docs/hardware/devices), чтобы найти подходящую прошивку.
Для большинства устройств из этого гайда нужен .hex.
Скопируйте файл прошивки на Raspberry Pi.

## Прошивка Firmware

Когда openocd запущен, подключитесь к устройству Meshtastic через telnet.
Прошивка — это несколько команд в telnet-сессии:

```
$ telnet 127.0.0.1 4444
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
Open On-Chip Debugger
> init
> reset init
> halt
> nrf5 mass_erase
> program firmware.hex verify
> reset
> exit 0
```

После прошивки отключите питание и снова включите.

## Подключение

Готово! Теперь можно подключиться к устройству по Bluetooth в приложении Meshtastic.